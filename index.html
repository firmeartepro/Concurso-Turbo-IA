<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concurso Turbo IA - Sistema Completo de Estudos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .typing-animation { border-right: 2px solid #667eea; animation: blink 1s infinite; }
        @keyframes blink { 0%, 50% { border-color: transparent; } 51%, 100% { border-color: #667eea; } }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .chat-message { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .question-card { transition: all 0.3s ease; border-left: 4px solid transparent; }
        .question-card.correct { border-left-color: #10b981; background-color: #f0fdf4; }
        .question-card.incorrect { border-left-color: #ef4444; background-color: #fef2f2; }
        .study-material { background: linear-gradient(145deg, #f8fafc, #e2e8f0); }
        .gemini-gradient { background: linear-gradient(135deg, #4285f4 0%, #34a853 25%, #fbbc05 50%, #ea4335 75%, #4285f4 100%); }
        .gemini-text { background: linear-gradient(45deg, #4285f4, #34a853, #fbbc05, #ea4335); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .countdown-timer { font-family: 'Courier New', monospace; }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle { transition: stroke-dasharray 0.35s; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
        <div class="text-center text-white">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"></div>
            <h2 class="text-3xl font-bold">Concurso Turbo IA</h2>
            <p class="text-lg opacity-90">Carregando seu ambiente de estudos...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-20 h-20 gradient-bg rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-rocket text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800">Concurso Turbo IA</h1>
                <p class="text-gray-600 mt-2">Sistema Inteligente de Estudos</p>
                <div class="mt-4 p-3 gemini-gradient rounded-lg">
                    <p class="text-white text-sm font-semibold">ü§ñ Powered by Google Gemini AI</p>
                </div>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="loginPassword" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button type="submit" 
                        class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition duration-300">
                    Entrar
                </button>
            </form>
            
            <div id="loginError" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden"></div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="min-h-screen bg-gray-50" style="display: none;">
        <!-- Admin Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <i class="fas fa-user-shield text-2xl mr-3"></i>
                        <h1 class="text-2xl font-bold">Painel Administrativo - Concurso Turbo IA</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="adminName" class="text-lg"></span>
                        <button onclick="logout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition duration-300">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Admin Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button onclick="showAdminSection('dashboard')" class="admin-nav-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium">
                        <i class="fas fa-chart-line mr-2"></i>Dashboard
                    </button>
                    <button onclick="showAdminSection('users')" class="admin-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-users mr-2"></i>Usu√°rios
                    </button>
                    <button onclick="showAdminSection('contests')" class="admin-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-trophy mr-2"></i>Concursos
                    </button>
                    <button onclick="showAdminSection('ai-config')" class="admin-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-robot mr-2"></i>Config IA
                    </button>
                </div>
            </div>
        </nav>

        <!-- Admin Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Section -->
            <div id="adminDashboardSection" class="admin-section">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-users text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total de Usu√°rios</p>
                                <p id="totalUsers" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 text-green-600">
                                <i class="fas fa-user-check text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Usu√°rios Ativos</p>
                                <p id="activeUsers" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-book text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Simulados Realizados</p>
                                <p id="totalSimulations" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                <i class="fas fa-chart-line text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Taxa de Aprova√ß√£o</p>
                                <p id="approvalRate" class="text-2xl font-bold text-gray-900">0%</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="adminUsersSection" class="admin-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Gerenciar Usu√°rios</h2>
                        <button onclick="showAddUserModal()" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 transition duration-300">
                            <i class="fas fa-plus mr-2"></i>Adicionar Usu√°rio
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Plano</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progresso</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable" class="bg-white divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- AI Config Section -->
            <div id="adminAi-configSection" class="admin-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Configura√ß√£o da IA Gemini</h2>
                    
                    <div class="gemini-gradient rounded-lg p-6 mb-6 text-white">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-robot text-3xl mr-4"></i>
                            <div>
                                <h3 class="text-xl font-bold">Google Gemini AI Integration</h3>
                                <p class="opacity-90">Configure a API do Gemini para funcionalidades avan√ßadas</p>
                            </div>
                        </div>
                    </div>

                    <form id="geminiConfigForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-key mr-2"></i>Chave da API Gemini
                            </label>
                            <input type="password" id="geminiApiKey" 
                                   placeholder="Cole sua chave da API do Google Gemini aqui..."
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-sm text-gray-600 mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Obtenha sua chave em: <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline">Google AI Studio</a>
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-cog mr-2"></i>Modelo Gemini
                            </label>
                            <select id="geminiModel" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="gemini-pro">Gemini Pro (Recomendado)</option>
                                <option value="gemini-pro-vision">Gemini Pro Vision</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-thermometer-half mr-2"></i>Temperatura da IA (Criatividade)
                            </label>
                            <input type="range" id="geminiTemperature" min="0" max="1" step="0.1" value="0.7" 
                                   class="w-full">
                            <div class="flex justify-between text-sm text-gray-600">
                                <span>Conservador (0)</span>
                                <span id="temperatureValue">0.7</span>
                                <span>Criativo (1)</span>
                            </div>
                        </div>

                        <div class="flex items-center space-x-4">
                            <button type="submit" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition duration-300">
                                <i class="fas fa-save mr-2"></i>Salvar Configura√ß√£o
                            </button>
                            <button type="button" onclick="testGeminiConnection()" class="border border-blue-600 text-blue-600 px-6 py-3 rounded-lg hover:bg-blue-50 transition duration-300">
                                <i class="fas fa-plug mr-2"></i>Testar Conex√£o
                            </button>
                        </div>
                    </form>

                    <div id="geminiStatus" class="mt-6 p-4 rounded-lg hidden">
                        <!-- Status will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="min-h-screen bg-gray-50" style="display: none;">
        <!-- Student Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <i class="fas fa-rocket text-2xl mr-3"></i>
                        <h1 class="text-2xl font-bold">Concurso Turbo IA</h1>
                        <div class="ml-4 px-3 py-1 bg-white bg-opacity-20 rounded-full">
                            <span class="text-sm font-semibold">ü§ñ Gemini AI</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <div class="text-sm opacity-90">Tempo restante</div>
                            <div id="timeRemaining" class="countdown-timer text-lg font-bold">--</div>
                        </div>
                        <span id="studentName" class="text-lg"></span>
                        <button onclick="logout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition duration-300">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Student Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button onclick="showStudentSection('dashboard')" class="student-nav-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium">
                        <i class="fas fa-home mr-2"></i>Dashboard
                    </button>
                    <button onclick="showStudentSection('profile')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-user mr-2"></i>Perfil
                    </button>
                    <button onclick="showStudentSection('materials')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-book mr-2"></i>Materiais
                    </button>
                    <button onclick="showStudentSection('simulations')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-clipboard-list mr-2"></i>Simulados
                    </button>
                    <button onclick="showStudentSection('chat')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-robot mr-2"></i>Chat IA
                    </button>
                    <button onclick="showStudentSection('progress')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-chart-line mr-2"></i>Progresso
                    </button>
                    <button onclick="showStudentSection('ai-config')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-robot mr-2"></i>Config IA
                    </button>
                </div>
            </div>
        </nav>

        <!-- Student Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Section -->
            <div id="studentDashboardSection" class="student-section">
                <!-- Study Progress Ring -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Progresso de Estudos</h2>
                            <p class="text-gray-600">Acompanhe seu desempenho di√°rio</p>
                        </div>
                        <div class="relative">
                            <svg class="progress-ring w-24 h-24">
                                <circle class="progress-ring-circle stroke-current text-gray-300" 
                                        stroke-width="4" fill="transparent" r="40" cx="48" cy="48"/>
                                <circle id="progressCircle" class="progress-ring-circle stroke-current text-blue-600" 
                                        stroke-width="4" fill="transparent" r="40" cx="48" cy="48"
                                        stroke-dasharray="251.2" stroke-dashoffset="251.2"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="progressPercentage" class="text-lg font-bold text-gray-800">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-clock text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Horas Estudadas</p>
                                <p id="studyHours" class="text-2xl font-bold text-gray-900">0h</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 text-green-600">
                                <i class="fas fa-check-circle text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Quest√µes Resolvidas</p>
                                <p id="questionsAnswered" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-percentage text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Taxa de Acerto</p>
                                <p id="accuracyRate" class="text-2xl font-bold text-gray-900">0%</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                <i class="fas fa-trophy text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Ranking</p>
                                <p id="userRanking" class="text-2xl font-bold text-gray-900">#0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Study Plan -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Plano de Estudos Personalizado</h2>
                    <div id="studyPlanContent" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center py-8">
                            <i class="fas fa-user-cog text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-600 mb-2">Configure seu perfil</h3>
                            <p class="text-gray-500 mb-4">Complete seus dados para receber um plano personalizado</p>
                            <button onclick="showStudentSection('profile')" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90">
                                Configurar Agora
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="studentProfileSection" class="student-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Configurar Perfil de Estudos</h2>
                    
                    <form id="profileForm" class="space-y-6">
                        <!-- Personal Info -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                                <input type="text" id="fullName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Data de Nascimento</label>
                                <input type="date" id="birthDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <!-- Contest Info -->
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Informa√ß√µes do Concurso</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Concurso</label>
                                    <select id="contestType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">Selecione um concurso</option>
                                        <option value="enem">ENEM</option>
                                        <option value="vestibular">Vestibular</option>
                                        <option value="concurso-publico">Concurso P√∫blico</option>
                                        <option value="oab">OAB</option>
                                        <option value="medicina">Medicina</option>
                                        <option value="engenharia">Engenharia</option>
                                        <option value="direito">Direito</option>
                                        <option value="outros">Outros</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Institui√ß√£o/√ìrg√£o</label>
                                    <input type="text" id="institution" placeholder="Ex: INEP, FGV, CESPE..." 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Data da Prova</label>
                                    <input type="date" id="examDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cargo/Curso Desejado</label>
                                    <input type="text" id="targetPosition" placeholder="Ex: Analista, Medicina, Direito..." 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>

                        <!-- Study Preferences -->
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Prefer√™ncias de Estudo</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Horas por Dia</label>
                                    <select id="dailyHours" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="2">2 horas</option>
                                        <option value="4">4 horas</option>
                                        <option value="6">6 horas</option>
                                        <option value="8">8 horas</option>
                                        <option value="10">10+ horas</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Melhor Hor√°rio</label>
                                    <select id="studyTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="manha">Manh√£</option>
                                        <option value="tarde">Tarde</option>
                                        <option value="noite">Noite</option>
                                        <option value="madrugada">Madrugada</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">N√≠vel Atual</label>
                                    <select id="currentLevel" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="iniciante">Iniciante</option>
                                        <option value="intermediario">Intermedi√°rio</option>
                                        <option value="avancado">Avan√ßado</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Study Content -->
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Conte√∫do Program√°tico</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-list-ul mr-2"></i>Cole aqui o conte√∫do program√°tico completo do seu concurso
                                    </label>
                                    <textarea id="studyContent" rows="8" 
                                              placeholder="Exemplo:&#10;&#10;PORTUGU√äS:&#10;- Interpreta√ß√£o de textos&#10;- Gram√°tica normativa&#10;- Reda√ß√£o oficial&#10;&#10;MATEM√ÅTICA:&#10;- √Ålgebra linear&#10;- Estat√≠stica b√°sica&#10;- Matem√°tica financeira&#10;&#10;DIREITO ADMINISTRATIVO:&#10;- Princ√≠pios da administra√ß√£o p√∫blica&#10;- Atos administrativos&#10;- Licita√ß√µes e contratos..."
                                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-vertical min-h-32"></textarea>
                                    <p class="text-sm text-gray-600 mt-2">
                                        <i class="fas fa-lightbulb mr-1 text-yellow-500"></i>
                                        <strong>Dica:</strong> Quanto mais detalhado o conte√∫do, melhor ser√° o plano de estudos gerado pela IA!
                                    </p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes Adicionais (Opcional)</label>
                                    <textarea id="studyNotes" rows="3" 
                                              placeholder="Ex: Tenho mais dificuldade em matem√°tica, preciso focar mais em reda√ß√£o, j√° estudei direito constitucional..."
                                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-4 pt-6">
                            <button type="button" onclick="resetProfile()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                Limpar
                            </button>
                            <button type="submit" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90">
                                <i class="fas fa-save mr-2"></i>Salvar Perfil
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Materials Section -->
            <div id="studentMaterialsSection" class="student-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Materiais de Estudo</h2>
                        <button onclick="generateAIMaterials()" class="gemini-gradient text-white px-6 py-2 rounded-lg hover:opacity-90">
                            <i class="fas fa-robot mr-2"></i>Gerar com IA
                        </button>
                    </div>
                    <div id="materialsContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="study-material rounded-lg p-6 card-hover text-center">
                            <i class="fas fa-user-cog text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-600 mb-2">Configure seu perfil</h3>
                            <p class="text-gray-500 text-sm">Complete seu perfil para ver materiais personalizados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulations Section -->
            <div id="studentSimulationsSection" class="student-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Simulados</h2>
                        <button onclick="generateAISimulation()" class="gemini-gradient text-white px-6 py-2 rounded-lg hover:opacity-90">
                            <i class="fas fa-robot mr-2"></i>Criar com IA
                        </button>
                    </div>
                    <div id="simulationsContent">
                        <div class="text-center py-12">
                            <i class="fas fa-clipboard-list text-6xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">Configure seu perfil primeiro</h3>
                            <p class="text-gray-500">Complete seu perfil para ver simulados personalizados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Section -->
            <div id="studentChatSection" class="student-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6 h-96 flex flex-col">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 gemini-gradient rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-robot text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold gemini-text">Gemini AI - Professor Virtual</h2>
                            <p class="text-sm text-gray-600">Intelig√™ncia artificial educacional do Google</p>
                        </div>
                        <div class="ml-auto">
                            <div id="aiStatus" class="flex items-center px-3 py-1 rounded-full text-sm">
                                <i class="fas fa-circle text-red-500 mr-2"></i>
                                <span>IA Desconectada</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex-1 flex flex-col">
                        <div id="chatMessages" class="flex-1 overflow-y-auto mb-4 p-4 bg-gray-50 rounded-lg">
                            <div class="chat-message mb-4">
                                <div class="flex items-start">
                                    <div class="w-8 h-8 gemini-gradient rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-robot text-white text-sm"></i>
                                    </div>
                                    <div class="bg-white rounded-lg p-3 shadow-sm">
                                        <p class="text-gray-800">Ol√°! Sou o Gemini, sua IA educacional! ü§ñ Configure a API no painel administrativo para come√ßarmos a conversar!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex">
                            <input type="text" id="chatInput" placeholder="Digite sua pergunta para o Gemini..." 
                                   class="flex-1 px-4 py-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   onkeypress="if(event.key==='Enter') sendMessage()" disabled>
                            <button onclick="sendMessage()" class="gemini-gradient text-white px-6 py-3 rounded-r-lg hover:opacity-90 transition duration-300" disabled>
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Section -->
            <div id="studentProgressSection" class="student-section" style="display: none;">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Progresso por Mat√©ria</h2>
                        <div id="subjectProgress" class="space-y-4">
                            <div class="text-center py-8">
                                <i class="fas fa-chart-bar text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">Configure seu perfil para ver o progresso</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Hist√≥rico de Simulados</h2>
                        <div id="simulationHistory" class="space-y-4">
                            <div class="text-center py-8">
                                <i class="fas fa-history text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">Nenhum simulado realizado ainda</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Study Calendar -->
                <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Calend√°rio de Estudos</h2>
                    <div id="studyCalendar" class="grid grid-cols-7 gap-2">
                        <!-- Calendar will be generated here -->
                    </div>
                </div>
            </div>

            <!-- AI Config Section -->
            <div id="studentAi-configSection" class="student-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Configura√ß√£o da sua IA Pessoal</h2>
                    
                    <!-- Tutorial Section -->
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-8 border border-blue-200">
                        <div class="flex items-start">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                                <i class="fas fa-graduation-cap text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 mb-3">üéØ Como configurar sua IA para ser um VENCEDOR!</h3>
                                <div class="space-y-3 text-sm text-gray-700">
                                    <div class="flex items-start">
                                        <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                                        <div>
                                            <p class="font-semibold">Acesse o Google AI Studio (GR√ÅTIS!)</p>
                                            <p>V√° em: <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline font-medium">https://aistudio.google.com/app/apikey</a></p>
                                        </div>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                                        <div>
                                            <p class="font-semibold">Fa√ßa login com sua conta Google</p>
                                            <p>√â gratuito e voc√™ tem acesso completo ao Gemini!</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                                        <div>
                                            <p class="font-semibold">Clique em "Create API Key"</p>
                                            <p>Copie a chave gerada e cole no campo abaixo</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">‚úì</span>
                                        <div>
                                            <p class="font-semibold text-green-700">Pronto! Sua IA pessoal est√° configurada!</p>
                                            <p>Agora voc√™ ter√° acesso a conte√∫dos, simulados e planos de estudo personalizados!</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="gemini-gradient rounded-lg p-6 mb-6 text-white">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-robot text-3xl mr-4"></i>
                            <div>
                                <h3 class="text-xl font-bold">Sua IA Educacional Pessoal</h3>
                                <p class="opacity-90">Configure o Gemini AI para turbinar seus estudos</p>
                            </div>
                        </div>
                    </div>

                    <form id="studentGeminiConfigForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-key mr-2"></i>Sua Chave da API Gemini (Gratuita)
                            </label>
                            <input type="password" id="studentGeminiApiKey" 
                                   placeholder="Cole sua chave da API do Google Gemini aqui..."
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <div class="mt-2 p-3 bg-green-50 border border-green-200 rounded-lg">
                                <p class="text-sm text-green-800">
                                    <i class="fas fa-gift mr-1"></i>
                                    <strong>100% GRATUITO!</strong> O Google oferece acesso gratuito ao Gemini AI. 
                                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-green-600 hover:underline font-medium">Clique aqui para obter sua chave</a>
                                </p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-cog mr-2"></i>Modelo da IA
                                </label>
                                <select id="studentGeminiModel" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="gemini-pro">Gemini Pro (Recomendado)</option>
                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash (Mais R√°pido)</option>
                                    <option value="gemini-1.5-pro">Gemini 1.5 Pro (Mais Avan√ßado)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-thermometer-half mr-2"></i>Criatividade da IA
                                </label>
                                <select id="studentGeminiTemperature" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="0.3">Conservador (Mais Preciso)</option>
                                    <option value="0.7" selected>Equilibrado (Recomendado)</option>
                                    <option value="0.9">Criativo (Mais Variado)</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex items-center space-x-4">
                            <button type="submit" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition duration-300">
                                <i class="fas fa-save mr-2"></i>Salvar Configura√ß√£o
                            </button>
                            <button type="button" onclick="testStudentGeminiConnection()" class="border border-blue-600 text-blue-600 px-6 py-3 rounded-lg hover:bg-blue-50 transition duration-300">
                                <i class="fas fa-plug mr-2"></i>Testar IA
                            </button>
                        </div>
                    </form>

                    <div id="studentGeminiStatus" class="mt-6 p-4 rounded-lg hidden">
                        <!-- Status will be shown here -->
                    </div>

                    <!-- AI Capabilities -->
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 text-center">
                            <i class="fas fa-brain text-3xl text-blue-600 mb-3"></i>
                            <h4 class="font-bold text-gray-800 mb-2">Planos Personalizados</h4>
                            <p class="text-sm text-gray-600">IA cria cronogramas baseados no seu conte√∫do program√°tico</p>
                        </div>
                        <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 text-center">
                            <i class="fas fa-clipboard-list text-3xl text-green-600 mb-3"></i>
                            <h4 class="font-bold text-gray-800 mb-2">Simulados Inteligentes</h4>
                            <p class="text-sm text-gray-600">Quest√µes geradas especificamente para seu concurso</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 text-center">
                            <i class="fas fa-comments text-3xl text-purple-600 mb-3"></i>
                            <h4 class="font-bold text-gray-800 mb-2">Professor Virtual</h4>
                            <p class="text-sm text-gray-600">Tire d√∫vidas e receba explica√ß√µes detalhadas</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Adicionar Usu√°rio</h2>
            <form id="addUserForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome</label>
                    <input type="text" id="newUserName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="newUserEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="newUserPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Plano</label>
                    <select id="newUserPlan" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="basic">B√°sico</option>
                        <option value="premium">Premium</option>
                        <option value="vip">VIP</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Data de Expira√ß√£o</label>
                    <input type="date" id="newUserExpiry" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" onclick="hideAddUserModal()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancelar
                    </button>
                    <button type="submit" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90">
                        Adicionar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Simulation Modal -->
    <div id="simulationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-4xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 id="simulationTitle" class="text-2xl font-bold text-gray-800">Simulado</h2>
                <button onclick="closeSimulation()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="simulationContent">
                <!-- Simulation content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration - SUBSTITUA PELAS SUAS CHAVES
       const firebaseConfig = {
  apiKey: "AIzaSyCpR8xBkgo4zA9m0-MSl2pI09KsVEKsR9Y",
  authDomain: "concurso-turbo-ia.firebaseapp.com",
  projectId: "concurso-turbo-ia",
  storageBucket: "concurso-turbo-ia.firebasestorage.app",
  messagingSenderId: "559351714048",
  appId: "1:559351714048:web:18894243f16acae36763e5"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global Variables
        let currentUser = null;
        let userProfile = null;
        let geminiApiKey = null;
        let geminiConfig = {
            model: 'gemini-pro',
            temperature: 0.7
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                checkAuthState();
            }, 2000);

            // Load Gemini config
            loadGeminiConfig();
            
            // Setup temperature slider
            const tempSlider = document.getElementById('geminiTemperature');
            const tempValue = document.getElementById('temperatureValue');
            if (tempSlider && tempValue) {
                tempSlider.addEventListener('input', function() {
                    tempValue.textContent = this.value;
                });
            }
        });

        // Auth State Observer
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    if (userData.isAdmin) {
                        showAdminDashboard(userData);
                    } else {
                        showStudentDashboard(userData);
                    }
                }
            } else {
                showLoginScreen();
            }
        });

        function checkAuthState() {
            const user = auth.currentUser;
            if (!user) {
                showLoginScreen();
            }
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('studentDashboard').style.display = 'none';
        }

        function showAdminDashboard(userData) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            document.getElementById('studentDashboard').style.display = 'none';
            document.getElementById('adminName').textContent = userData.name;
            loadAdminData();
        }

        function showStudentDashboard(userData) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('studentDashboard').style.display = 'block';
            document.getElementById('studentName').textContent = userData.name;
            loadStudentData(userData);
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        // Login Form Handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                document.getElementById('loginError').textContent = 'Email ou senha incorretos';
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        // Logout Function
        function logout() {
            auth.signOut();
        }

        // Admin Functions
        function showAdminSection(section) {
            document.querySelectorAll('.admin-section').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('admin' + section.charAt(0).toUpperCase() + section.slice(1) + 'Section').style.display = 'block';

            document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-blue-500', 'text-blue-600');
        }

        async function loadAdminData() {
            try {
                const usersSnapshot = await db.collection('users').get();
                const users = [];
                let activeUsers = 0;
                
                usersSnapshot.forEach(doc => {
                    const userData = doc.data();
                    if (!userData.isAdmin) {
                        users.push({ id: doc.id, ...userData });
                        if (userData.active) activeUsers++;
                    }
                });

                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('activeUsers').textContent = activeUsers;
                document.getElementById('totalSimulations').textContent = Math.floor(Math.random() * 500) + 100;
                document.getElementById('approvalRate').textContent = Math.floor(Math.random() * 30) + 70 + '%';

                displayUsersTable(users);
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        function displayUsersTable(users) {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '';

            users.forEach(user => {
                const progress = user.studyProgress || 0;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                            ${user.plan}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${user.active ? 'Ativo' : 'Inativo'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${progress}%"></div>
                        </div>
                        <span class="text-xs text-gray-500">${progress}%</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="toggleUserStatus('${user.id}', ${!user.active})" class="text-indigo-600 hover:text-indigo-900 mr-3">
                            ${user.active ? 'Desativar' : 'Ativar'}
                        </button>
                        <button onclick="deleteUser('${user.id}')" class="text-red-600 hover:text-red-900">
                            Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddUserModal() {
            document.getElementById('addUserModal').style.display = 'flex';
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
            document.getElementById('addUserForm').reset();
        }

        // Add User Form Handler
        document.getElementById('addUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const password = document.getElementById('newUserPassword').value;
            const plan = document.getElementById('newUserPlan').value;
            const expiryDate = document.getElementById('newUserExpiry').value;

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    plan: plan,
                    expiryDate: expiryDate,
                    active: true,
                    isAdmin: false,
                    createdDate: new Date().toISOString().split('T')[0],
                    studyProgress: 0,
                    studyHours: 0,
                    questionsAnswered: 0,
                    accuracyRate: 0
                });

                hideAddUserModal();
                loadAdminData();
                alert('Usu√°rio adicionado com sucesso!');
            } catch (error) {
                alert('Erro ao adicionar usu√°rio: ' + error.message);
            }
        });

        async function toggleUserStatus(userId, newStatus) {
            try {
                await db.collection('users').doc(userId).update({
                    active: newStatus
                });
                loadAdminData();
            } catch (error) {
                alert('Erro ao alterar status do usu√°rio');
            }
        }

        async function deleteUser(userId) {
            if (confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                try {
                    await db.collection('users').doc(userId).delete();
                    loadAdminData();
                } catch (error) {
                    alert('Erro ao excluir usu√°rio');
                }
            }
        }

        // Gemini Configuration
        async function loadGeminiConfig() {
            try {
                // Load admin config first
                const configDoc = await db.collection('config').doc('gemini').get();
                if (configDoc.exists) {
                    const config = configDoc.data();
                    geminiApiKey = config.apiKey;
                    geminiConfig = { ...geminiConfig, ...config };
                    
                    if (geminiApiKey) {
                        updateAIStatus(true);
                        if (document.getElementById('geminiApiKey')) {
                            document.getElementById('geminiApiKey').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                            document.getElementById('geminiModel').value = geminiConfig.model;
                            document.getElementById('geminiTemperature').value = geminiConfig.temperature;
                            document.getElementById('temperatureValue').textContent = geminiConfig.temperature;
                        }
                    }
                }

                // Load student config if exists
                if (currentUser) {
                    const studentConfigDoc = await db.collection('users').doc(currentUser.uid).collection('config').doc('gemini').get();
                    if (studentConfigDoc.exists) {
                        const studentConfig = studentConfigDoc.data();
                        geminiApiKey = studentConfig.apiKey;
                        geminiConfig = { ...geminiConfig, ...studentConfig };
                        
                        if (geminiApiKey) {
                            updateAIStatus(true);
                            if (document.getElementById('studentGeminiApiKey')) {
                                document.getElementById('studentGeminiApiKey').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                                document.getElementById('studentGeminiModel').value = geminiConfig.model;
                                document.getElementById('studentGeminiTemperature').value = geminiConfig.temperature;
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading Gemini config:', error);
            }
        }

        document.getElementById('geminiConfigForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const apiKey = document.getElementById('geminiApiKey').value;
            const model = document.getElementById('geminiModel').value;
            const temperature = parseFloat(document.getElementById('geminiTemperature').value);

            if (apiKey && apiKey !== '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                geminiApiKey = apiKey;
            }
            
            geminiConfig = { model, temperature };

            try {
                await db.collection('config').doc('gemini').set({
                    apiKey: geminiApiKey,
                    model: model,
                    temperature: temperature,
                    updatedAt: new Date()
                });

                showGeminiStatus('Configura√ß√£o salva com sucesso!', 'success');
                updateAIStatus(true);
            } catch (error) {
                showGeminiStatus('Erro ao salvar configura√ß√£o: ' + error.message, 'error');
            }
        });

        async function testGeminiConnection() {
            if (!geminiApiKey) {
                showGeminiStatus('Configure a chave da API primeiro', 'error');
                return;
            }

            showGeminiStatus('Testando conex√£o...', 'info');

            try {
                const response = await callGeminiAPI('Ol√°, voc√™ est√° funcionando?');
                showGeminiStatus('Conex√£o bem-sucedida! IA respondeu: ' + response.substring(0, 100) + '...', 'success');
                updateAIStatus(true);
            } catch (error) {
                showGeminiStatus('Erro na conex√£o: ' + error.message, 'error');
                updateAIStatus(false);
            }
        }

        // Student Gemini Configuration
        document.addEventListener('DOMContentLoaded', function() {
            const studentGeminiForm = document.getElementById('studentGeminiConfigForm');
            if (studentGeminiForm) {
                studentGeminiForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const apiKey = document.getElementById('studentGeminiApiKey').value;
                    const model = document.getElementById('studentGeminiModel').value;
                    const temperature = parseFloat(document.getElementById('studentGeminiTemperature').value);

                    if (apiKey && apiKey !== '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                        geminiApiKey = apiKey;
                    }
                    
                    geminiConfig = { model, temperature };

                    try {
                        await db.collection('users').doc(currentUser.uid).collection('config').doc('gemini').set({
                            apiKey: geminiApiKey,
                            model: model,
                            temperature: temperature,
                            updatedAt: new Date()
                        });

                        showStudentGeminiStatus('Configura√ß√£o salva com sucesso!', 'success');
                        updateAIStatus(true);
                    } catch (error) {
                        showStudentGeminiStatus('Erro ao salvar configura√ß√£o: ' + error.message, 'error');
                    }
                });
            }
        });

        async function testStudentGeminiConnection() {
            if (!geminiApiKey) {
                showStudentGeminiStatus('Configure a chave da API primeiro', 'error');
                return;
            }

            showStudentGeminiStatus('Testando sua IA pessoal...', 'info');

            try {
                const response = await callGeminiAPI('Ol√°! Voc√™ est√° pronto para me ajudar a estudar?');
                showStudentGeminiStatus('üéâ Sua IA est√° funcionando perfeitamente! Resposta: ' + response.substring(0, 100) + '...', 'success');
                updateAIStatus(true);
            } catch (error) {
                showStudentGeminiStatus('Erro na conex√£o: ' + error.message, 'error');
                updateAIStatus(false);
            }
        }

        function showStudentGeminiStatus(message, type) {
            const statusDiv = document.getElementById('studentGeminiStatus');
            statusDiv.className = `mt-6 p-4 rounded-lg ${
                type === 'success' ? 'bg-green-100 border border-green-400 text-green-700' :
                type === 'error' ? 'bg-red-100 border border-red-400 text-red-700' :
                'bg-blue-100 border border-blue-400 text-blue-700'
            }`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
        }

        function showGeminiStatus(message, type) {
            const statusDiv = document.getElementById('geminiStatus');
            statusDiv.className = `mt-6 p-4 rounded-lg ${
                type === 'success' ? 'bg-green-100 border border-green-400 text-green-700' :
                type === 'error' ? 'bg-red-100 border border-red-400 text-red-700' :
                'bg-blue-100 border border-blue-400 text-blue-700'
            }`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
        }

        function updateAIStatus(connected) {
            const statusDiv = document.getElementById('aiStatus');
            const chatInput = document.getElementById('chatInput');
            const chatButton = document.querySelector('#studentChatSection button[onclick="sendMessage()"]');
            
            if (connected) {
                statusDiv.innerHTML = '<i class="fas fa-circle text-green-500 mr-2"></i><span>IA Conectada</span>';
                statusDiv.className = 'flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm';
                if (chatInput) chatInput.disabled = false;
                if (chatButton) chatButton.disabled = false;
            } else {
                statusDiv.innerHTML = '<i class="fas fa-circle text-red-500 mr-2"></i><span>IA Desconectada</span>';
                statusDiv.className = 'flex items-center px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm';
                if (chatInput) chatInput.disabled = true;
                if (chatButton) chatButton.disabled = true;
            }
        }

        // Student Functions
        function showStudentSection(section) {
            document.querySelectorAll('.student-section').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('student' + section.charAt(0).toUpperCase() + section.slice(1) + 'Section').style.display = 'block';

            document.querySelectorAll('.student-nav-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-blue-500', 'text-blue-600');
        }

        async function loadStudentData(userData) {
            userProfile = userData.profile || {};
            
            // Load stats
            document.getElementById('studyHours').textContent = (userData.studyHours || 0) + 'h';
            document.getElementById('questionsAnswered').textContent = userData.questionsAnswered || '0';
            document.getElementById('accuracyRate').textContent = (userData.accuracyRate || 0) + '%';
            document.getElementById('userRanking').textContent = '#' + (userData.ranking || 'N/A');

            // Update progress ring
            const progress = userData.studyProgress || 0;
            updateProgressRing(progress);

            // Load profile if exists
            if (userProfile.fullName) {
                loadProfileData();
                generateStudyPlan();
                loadMaterials();
                loadSimulations();
                loadProgressData();
            }
        }

        function updateProgressRing(percentage) {
            const circle = document.getElementById('progressCircle');
            const percentageText = document.getElementById('progressPercentage');
            
            const circumference = 2 * Math.PI * 40;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            percentageText.textContent = percentage + '%';
        }

        function updateCountdown() {
            if (!userProfile.examDate) {
                document.getElementById('timeRemaining').textContent = 'Configure a data da prova';
                return;
            }

            const examDate = new Date(userProfile.examDate);
            const now = new Date();
            const timeDiff = examDate - now;

            if (timeDiff <= 0) {
                document.getElementById('timeRemaining').textContent = 'Prova realizada';
                return;
            }

            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));

            document.getElementById('timeRemaining').textContent = `${days}d ${hours}h ${minutes}m`;
        }

        // Profile Management
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const profileData = {
                fullName: document.getElementById('fullName').value,
                birthDate: document.getElementById('birthDate').value,
                contestType: document.getElementById('contestType').value,
                institution: document.getElementById('institution').value,
                examDate: document.getElementById('examDate').value,
                targetPosition: document.getElementById('targetPosition').value,
                dailyHours: parseInt(document.getElementById('dailyHours').value),
                studyTime: document.getElementById('studyTime').value,
                currentLevel: document.getElementById('currentLevel').value,
                studyContent: document.getElementById('studyContent').value,
                studyNotes: document.getElementById('studyNotes').value
            };

            try {
                await db.collection('users').doc(currentUser.uid).update({
                    profile: profileData,
                    updatedAt: new Date()
                });

                userProfile = profileData;
                alert('Perfil salvo com sucesso!');
                
                // Generate study plan and materials
                generateStudyPlan();
                loadMaterials();
                loadSimulations();
                loadProgressData();
                
                // Switch to dashboard
                showStudentSection('dashboard');
            } catch (error) {
                alert('Erro ao salvar perfil: ' + error.message);
            }
        });

        function loadProfileData() {
            if (!userProfile) return;

            document.getElementById('fullName').value = userProfile.fullName || '';
            document.getElementById('birthDate').value = userProfile.birthDate || '';
            document.getElementById('contestType').value = userProfile.contestType || '';
            document.getElementById('institution').value = userProfile.institution || '';
            document.getElementById('examDate').value = userProfile.examDate || '';
            document.getElementById('targetPosition').value = userProfile.targetPosition || '';
            document.getElementById('dailyHours').value = userProfile.dailyHours || '4';
            document.getElementById('studyTime').value = userProfile.studyTime || 'manha';
            document.getElementById('currentLevel').value = userProfile.currentLevel || 'intermediario';
            document.getElementById('studyContent').value = userProfile.studyContent || '';
            document.getElementById('studyNotes').value = userProfile.studyNotes || '';
        }

        function resetProfile() {
            document.getElementById('profileForm').reset();
        }

        function generateStudyPlan() {
            if (!userProfile.studyContent) return;

            const studyPlanContent = document.getElementById('studyPlanContent');
            const dailyHours = userProfile.dailyHours || 4;

            // Extract subjects from study content
            const subjects = extractSubjectsFromContent(userProfile.studyContent);
            const hoursPerSubject = subjects.length > 0 ? Math.floor(dailyHours / subjects.length) : dailyHours;

            if (subjects.length === 0) {
                studyPlanContent.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-robot text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">Plano Inteligente Pronto!</h3>
                        <p class="text-gray-500 mb-4">Baseado no seu conte√∫do program√°tico</p>
                        <button onclick="generateAIStudyPlan()" class="gemini-gradient text-white px-6 py-3 rounded-lg hover:opacity-90">
                            <i class="fas fa-brain mr-2"></i>Gerar Plano com IA
                        </button>
                    </div>
                `;
                return;
            }

            studyPlanContent.innerHTML = subjects.map(subject => `
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white card-hover">
                    <h3 class="text-lg font-semibold mb-2">${subject}</h3>
                    <p class="text-sm opacity-90 mb-2">${hoursPerSubject}h por dia</p>
                    <p class="text-sm opacity-90 mb-4">N√≠vel: ${userProfile.currentLevel}</p>
                    <button onclick="studySubject('${subject}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition duration-300">
                        Estudar Agora
                    </button>
                </div>
            `).join('');
        }

        function extractSubjectsFromContent(content) {
            if (!content) return [];
            
            const lines = content.split('\n');
            const subjects = [];
            
            lines.forEach(line => {
                line = line.trim();
                if (line && !line.startsWith('-') && !line.startsWith('‚Ä¢') && line.includes(':')) {
                    const subject = line.split(':')[0].trim();
                    if (subject && !subjects.includes(subject)) {
                        subjects.push(subject);
                    }
                }
            });
            
            return subjects.slice(0, 6); // Limit to 6 subjects for display
        }

        function loadMaterials() {
            if (!userProfile.studyContent) return;

            const materialsContent = document.getElementById('materialsContent');
            const subjects = extractSubjectsFromContent(userProfile.studyContent);

            if (subjects.length === 0) {
                materialsContent.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-robot text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">Materiais Inteligentes</h3>
                        <p class="text-gray-500 mb-4">Baseados no seu conte√∫do program√°tico</p>
                        <button onclick="generateAIMaterials()" class="gemini-gradient text-white px-6 py-3 rounded-lg hover:opacity-90">
                            <i class="fas fa-brain mr-2"></i>Gerar Materiais com IA
                        </button>
                    </div>
                `;
                return;
            }

            materialsContent.innerHTML = subjects.map(subject => `
                <div class="study-material rounded-lg p-6 card-hover">
                    <div class="text-center mb-4">
                        <i class="fas fa-book text-4xl text-blue-600 mb-2"></i>
                        <h3 class="text-lg font-semibold">${subject}</h3>
                        <p class="text-gray-600 text-sm">Material personalizado</p>
                    </div>
                    <div class="space-y-2">
                        <button onclick="generateSubjectMaterial('${subject}')" class="w-full bg-blue-100 hover:bg-blue-200 text-blue-800 py-2 px-4 rounded text-sm">
                            üìö Resumos com IA
                        </button>
                        <button onclick="generateSubjectExercises('${subject}')" class="w-full bg-green-100 hover:bg-green-200 text-green-800 py-2 px-4 rounded text-sm">
                            üìù Exerc√≠cios com IA
                        </button>
                        <button onclick="generateSubjectQuestions('${subject}')" class="w-full bg-purple-100 hover:bg-purple-200 text-purple-800 py-2 px-4 rounded text-sm">
                            ‚ùì Quest√µes com IA
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadSimulations() {
            if (!userProfile.contestType) return;

            const simulationsContent = document.getElementById('simulationsContent');
            simulationsContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-clock text-3xl text-blue-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Simulado R√°pido</h3>
                            <p class="text-gray-600 text-sm">10 quest√µes - 15 minutos</p>
                            <p class="text-gray-500 text-xs">${userProfile.contestType.toUpperCase()}</p>
                        </div>
                        <button onclick="startSimulation('quick')" class="w-full gradient-bg text-white py-2 rounded-lg hover:opacity-90 transition duration-300">
                            Iniciar
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-clipboard-list text-3xl text-green-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Simulado M√©dio</h3>
                            <p class="text-gray-600 text-sm">25 quest√µes - 45 minutos</p>
                            <p class="text-gray-500 text-xs">${userProfile.contestType.toUpperCase()}</p>
                        </div>
                        <button onclick="startSimulation('medium')" class="w-full gradient-bg text-white py-2 rounded-lg hover:opacity-90 transition duration-300">
                            Iniciar
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-trophy text-3xl text-yellow-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Simulado Completo</h3>
                            <p class="text-gray-600 text-sm">50 quest√µes - 90 minutos</p>
                            <p class="text-gray-500 text-xs">${userProfile.contestType.toUpperCase()}</p>
                        </div>
                        <button onclick="startSimulation('full')" class="w-full gradient-bg text-white py-2 rounded-lg hover:opacity-90 transition duration-300">
                            Iniciar
                        </button>
                    </div>
                </div>
                
                <div class="mt-8 text-center">
                    <button onclick="generateAISimulation()" class="gemini-gradient text-white px-8 py-3 rounded-lg hover:opacity-90 transition duration-300">
                        <i class="fas fa-robot mr-2"></i>Criar Simulado Personalizado com IA
                    </button>
                </div>
            `;
        }

        function loadProgressData() {
            if (!userProfile.studyContent) return;

            const subjects = extractSubjectsFromContent(userProfile.studyContent);
            
            // Subject Progress
            const subjectProgress = document.getElementById('subjectProgress');
            if (subjects.length === 0) {
                subjectProgress.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-chart-bar text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600">Configure seu conte√∫do program√°tico para ver o progresso</p>
                    </div>
                `;
            } else {
                subjectProgress.innerHTML = subjects.map(subject => {
                    const progress = Math.floor(Math.random() * 100); // Simulated progress
                    return `
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-book text-blue-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold">${subject}</h4>
                                    <p class="text-sm text-gray-600">${progress}% conclu√≠do</p>
                                </div>
                            </div>
                            <div class="w-24">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${progress}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Study Calendar
            generateStudyCalendar();
        }

        function generateStudyCalendar() {
            const calendar = document.getElementById('studyCalendar');
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Days of week header
            const daysOfWeek = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            calendar.innerHTML = daysOfWeek.map(day => 
                `<div class="text-center font-semibold text-gray-600 p-2">${day}</div>`
            ).join('');

            // Calendar days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                calendar.innerHTML += '<div class="p-2"></div>';
            }

            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = day === today.getDate();
                const hasStudy = Math.random() > 0.7; // Simulated study days
                
                calendar.innerHTML += `
                    <div class="p-2 text-center cursor-pointer hover:bg-gray-100 rounded ${
                        isToday ? 'bg-blue-100 text-blue-800 font-bold' : ''
                    }">
                        <div class="text-sm">${day}</div>
                        ${hasStudy ? '<div class="w-2 h-2 bg-green-500 rounded-full mx-auto mt-1"></div>' : ''}
                    </div>
                `;
            }
        }

        // Gemini AI Functions
        async function callGeminiAPI(message, context = '') {
            if (!geminiApiKey) {
                throw new Error('Chave da API n√£o configurada');
            }

            const prompt = context ? `${context}\n\nPergunta: ${message}` : message;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${geminiConfig.model}:generateContent?key=${geminiApiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: geminiConfig.temperature,
                        topK: 1,
                        topP: 1,
                        maxOutputTokens: 2048,
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`Erro na API: ${response.status}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || !geminiApiKey) return;

            addMessageToChat(message, 'user');
            input.value = '';
            addTypingIndicator();

            try {
                const context = `Voc√™ √© um professor virtual especializado em ${userProfile.contestType || 'concursos'} para ${userProfile.targetPosition || 'estudantes'}. 
                
                CONTE√öDO PROGRAM√ÅTICO DO ALUNO:
                ${userProfile.studyContent || 'Conte√∫do n√£o especificado'}
                
                OBSERVA√á√ïES ADICIONAIS:
                ${userProfile.studyNotes || 'Nenhuma observa√ß√£o adicional'}
                
                N√≠vel do aluno: ${userProfile.currentLevel || 'intermedi√°rio'}.
                Horas de estudo por dia: ${userProfile.dailyHours || 4}h
                
                INSTRU√á√ïES:
                - Responda de forma did√°tica, clara e motivadora
                - Foque no conte√∫do program√°tico espec√≠fico do aluno
                - Seja um verdadeiro mentor para ajudar o aluno a PASSAR no concurso
                - D√™ dicas pr√°ticas e estrat√©gias de estudo
                - Seja encorajador e positivo`;

                const response = await callGeminiAPI(message, context);
                removeTypingIndicator();
                addMessageToChat(response, 'ai');
            } catch (error) {
                removeTypingIndicator();
                addMessageToChat('Desculpe, ocorreu um erro. Verifique se a API est√° configurada corretamente na se√ß√£o "Config IA".', 'ai');
            }
        }

        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message mb-4';

            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex items-start justify-end">
                        <div class="bg-blue-600 text-white rounded-lg p-3 shadow-sm max-w-xs">
                            <p class="text-sm">${message}</p>
                        </div>
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center ml-3">
                            <i class="fas fa-user text-gray-600 text-sm"></i>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-start">
                        <div class="w-8 h-8 gemini-gradient rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-robot text-white text-sm"></i>
                        </div>
                        <div class="bg-white rounded-lg p-3 shadow-sm max-w-xs">
                            <p class="text-sm text-gray-800">${message}</p>
                        </div>
                    </div>
                `;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'chat-message mb-4';
            typingDiv.innerHTML = `
                <div class="flex items-start">
                    <div class="w-8 h-8 gemini-gradient rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm">
                        <p class="text-sm text-gray-800 typing-animation">Gemini est√° pensando...</p>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // AI Content Generation
        async function generateAIMaterials() {
            if (!geminiApiKey) {
                alert('Configure sua IA pessoal na se√ß√£o "Config IA" primeiro');
                return;
            }

            if (!userProfile.studyContent) {
                alert('Configure seu conte√∫do program√°tico no perfil primeiro');
                return;
            }

            try {
                const prompt = `Crie um plano de estudos COMPLETO e DETALHADO para ${userProfile.contestType || 'concurso'} - ${userProfile.targetPosition || 'cargo'}.

                CONTE√öDO PROGRAM√ÅTICO:
                ${userProfile.studyContent}

                OBSERVA√á√ïES DO ALUNO:
                ${userProfile.studyNotes || 'Nenhuma observa√ß√£o adicional'}

                PERFIL DO ESTUDANTE:
                - N√≠vel: ${userProfile.currentLevel}
                - Tempo dispon√≠vel: ${userProfile.dailyHours}h por dia
                - Melhor hor√°rio: ${userProfile.studyTime}
                - Data da prova: ${userProfile.examDate || 'N√£o informada'}

                CRIE UM PLANO QUE INCLUA:
                1. Cronograma semanal detalhado
                2. Distribui√ß√£o de tempo por mat√©ria
                3. Estrat√©gias espec√≠ficas para cada t√≥pico
                4. Dicas de memoriza√ß√£o e revis√£o
                5. Simulados e exerc√≠cios recomendados
                6. T√©cnicas de motiva√ß√£o e foco
                
                Seja espec√≠fico, pr√°tico e motivador. Este aluno PRECISA PASSAR!`;

                const response = await callGeminiAPI(prompt);
                showGeneratedContent('üìö Plano de Estudos Personalizado', response);
            } catch (error) {
                alert('Erro ao gerar materiais: ' + error.message);
            }
        }

        async function generateAIStudyPlan() {
            await generateAIMaterials();
        }

        async function generateAISimulation() {
            if (!geminiApiKey) {
                alert('Configure sua IA pessoal na se√ß√£o "Config IA" primeiro');
                return;
            }

            if (!userProfile.studyContent) {
                alert('Configure seu conte√∫do program√°tico no perfil primeiro');
                return;
            }

            try {
                const prompt = `Crie um SIMULADO COMPLETO de 15 quest√µes para ${userProfile.contestType || 'concurso'} - ${userProfile.targetPosition || 'cargo'}.

                BASEIE-SE NESTE CONTE√öDO PROGRAM√ÅTICO:
                ${userProfile.studyContent}

                OBSERVA√á√ïES DO ALUNO:
                ${userProfile.studyNotes || 'Nenhuma observa√ß√£o adicional'}

                N√çVEL: ${userProfile.currentLevel}

                FORMATO PARA CADA QUEST√ÉO:
                
                QUEST√ÉO X:
                [Enunciado claro e objetivo]
                
                a) [Alternativa A]
                b) [Alternativa B] 
                c) [Alternativa C]
                d) [Alternativa D]
                e) [Alternativa E]
                
                RESPOSTA: [Letra correta]
                
                EXPLICA√á√ÉO DETALHADA:
                [Explica√ß√£o completa do porqu√™ a resposta est√° correta e as outras est√£o erradas]
                
                ---
                
                INSTRU√á√ïES:
                - Quest√µes no estilo da banca ${userProfile.institution || 'do concurso'}
                - N√≠vel adequado ao perfil do aluno
                - Cubra diferentes t√≥picos do conte√∫do program√°tico
                - Seja rigoroso na corre√ß√£o
                - Inclua pegadinhas t√≠picas de concurso
                
                Este simulado deve preparar o aluno para PASSAR no concurso!`;

                const response = await callGeminiAPI(prompt);
                showGeneratedContent('üéØ Simulado Personalizado', response);
            } catch (error) {
                alert('Erro ao gerar simulado: ' + error.message);
            }
        }

        function showGeneratedContent(title, content) {
            const modal = document.getElementById('simulationModal');
            const titleElement = document.getElementById('simulationTitle');
            const contentElement = document.getElementById('simulationContent');

            titleElement.textContent = title;
            contentElement.innerHTML = `
                <div class="gemini-gradient rounded-lg p-4 mb-6 text-white">
                    <div class="flex items-center">
                        <i class="fas fa-robot text-xl mr-3"></i>
                        <div>
                            <h3 class="font-semibold">Conte√∫do Gerado por IA</h3>
                            <p class="text-sm opacity-90">Criado especialmente para voc√™ pelo Gemini AI</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg p-6 border max-h-96 overflow-y-auto">
                    <pre class="whitespace-pre-wrap text-sm text-gray-800">${content}</pre>
                </div>
                <div class="flex justify-center mt-6">
                    <button onclick="closeSimulation()" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 mr-3">
                        Fechar
                    </button>
                    <button onclick="saveGeneratedContent('${title}', \`${content.replace(/`/g, '\\`')}\`)" class="border border-blue-600 text-blue-600 px-6 py-2 rounded-lg hover:bg-blue-50">
                        Salvar Conte√∫do
                    </button>
                </div>
            `;

            modal.style.display = 'flex';
        }

        async function saveGeneratedContent(title, content) {
            try {
                await db.collection('generated_content').add({
                    userId: currentUser.uid,
                    title: title,
                    content: content,
                    createdAt: new Date()
                });
                alert('Conte√∫do salvo com sucesso!');
                closeSimulation();
            } catch (error) {
                alert('Erro ao salvar conte√∫do: ' + error.message);
            }
        }

        // Utility Functions
        function studySubject(subject) {
            if (!geminiApiKey) {
                alert('Configure sua IA pessoal na se√ß√£o "Config IA" primeiro');
                return;
            }
            generateSubjectMaterial(subject);
        }

        async function generateSubjectMaterial(subject) {
            if (!geminiApiKey) {
                alert('Configure sua IA pessoal na se√ß√£o "Config IA" primeiro');
                return;
            }

            try {
                const prompt = `Crie um RESUMO COMPLETO e DETALHADO sobre ${subject} para ${userProfile.contestType || 'concurso'}.

                BASEIE-SE NESTE CONTE√öDO PROGRAM√ÅTICO:
                ${userProfile.studyContent}

                FOQUE ESPECIFICAMENTE EM: ${subject}

                N√çVEL DO ALUNO: ${userProfile.currentLevel}

                CRIE UM RESUMO QUE INCLUA:
                1. Conceitos fundamentais
                2. Pontos mais cobrados em provas
                3. Dicas de memoriza√ß√£o
                4. Exemplos pr√°ticos
                5. Pegadinhas comuns
                6. F√≥rmulas ou regras importantes
                7. Conex√µes com outros t√≥picos
                
                Seja did√°tico, completo e focado na APROVA√á√ÉO!`;

                const response = await callGeminiAPI(prompt);
                showGeneratedContent(`üìö Resumo: ${subject}`, response);
            } catch (error) {
                alert('Erro ao gerar resumo: ' + error.message);
            }
        }

        async function generateSubjectExercises(subject) {
            if (!geminiApiKey) {
                alert('Configure sua IA pessoal na se√ß√£o "Config IA" primeiro');
                return;
            }

            try {
                const prompt = `Crie 8 EXERC√çCIOS PR√ÅTICOS sobre ${subject} para ${userProfile.contestType || 'concurso'}.

                BASEIE-SE NESTE CONTE√öDO PROGRAM√ÅTICO:
                ${userProfile.studyContent}

                FOQUE EM: ${subject}
                N√çVEL: ${userProfile.currentLevel}

                FORMATO PARA CADA EXERC√çCIO:
                
                EXERC√çCIO X:
                [Enunciado do exerc√≠cio]
                
                a) [Alternativa A]
                b) [Alternativa B]
                c) [Alternativa C]
                d) [Alternativa D]
                e) [Alternativa E]
                
                RESPOSTA: [Letra correta]
                RESOLU√á√ÉO: [Passo a passo detalhado]
                
                ---
                
                Varie o n√≠vel de dificuldade e cubra diferentes aspectos do t√≥pico!`;

                const response = await callGeminiAPI(prompt);
                showGeneratedContent(`üìù Exerc√≠cios: ${subject}`, response);
            } catch (error) {
                alert('Erro ao gerar exerc√≠cios: ' + error.message);
            }
        }

        async function generateSubjectQuestions(subject) {
            if (!geminiApiKey) {
                alert('Configure sua IA pessoal na se√ß√£o "Config IA" primeiro');
                return;
            }

            try {
                const prompt = `Crie 10 QUEST√ïES DE CONCURSO sobre ${subject} para ${userProfile.contestType || 'concurso'}.

                BASEIE-SE NESTE CONTE√öDO PROGRAM√ÅTICO:
                ${userProfile.studyContent}

                MAT√âRIA: ${subject}
                N√çVEL: ${userProfile.currentLevel}
                BANCA: ${userProfile.institution || 'Estilo de concurso p√∫blico'}

                FORMATO:
                
                QUEST√ÉO X:
                [Enunciado no estilo da banca]
                
                a) [Alternativa A]
                b) [Alternativa B]
                c) [Alternativa C]
                d) [Alternativa D]
                e) [Alternativa E]
                
                GABARITO: [Letra]
                COMENT√ÅRIO: [Explica√ß√£o detalhada]
                
                ---
                
                Inclua quest√µes com pegadinhas t√≠picas e diferentes n√≠veis de dificuldade!`;

                const response = await callGeminiAPI(prompt);
                showGeneratedContent(`‚ùì Quest√µes: ${subject}`, response);
            } catch (error) {
                alert('Erro ao gerar quest√µes: ' + error.message);
            }
        }

        function startSimulation(type) {
            alert(`Iniciando simulado ${type}...\n\nFuncionalidade em desenvolvimento.`);
        }

        function closeSimulation() {
            document.getElementById('simulationModal').style.display = 'none';
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96cd68e57783b54f',t:'MTc1NDgwNzA2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>






