<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduSmart Pro - Sistema Completo de Estudos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .typing-animation { border-right: 2px solid #667eea; animation: blink 1s infinite; }
        @keyframes blink { 0%, 50% { border-color: transparent; } 51%, 100% { border-color: #667eea; } }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .chat-message { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .question-card { transition: all 0.3s ease; border-left: 4px solid transparent; }
        .question-card.correct { border-left-color: #10b981; background-color: #f0fdf4; }
        .question-card.incorrect { border-left-color: #ef4444; background-color: #fef2f2; }
        .study-material { background: linear-gradient(145deg, #f8fafc, #e2e8f0); }
        .gemini-gradient { background: linear-gradient(135deg, #4285f4 0%, #34a853 25%, #fbbc05 50%, #ea4335 75%, #4285f4 100%); }
        .gemini-text { background: linear-gradient(45deg, #4285f4, #34a853, #fbbc05, #ea4335); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
        <div class="text-center text-white">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold">EduSmart Pro</h2>
            <p class="text-lg opacity-90">Carregando seu ambiente de estudos...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-20 h-20 gradient-bg rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-graduation-cap text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800">EduSmart Pro</h1>
                <p class="text-gray-600 mt-2">Sistema Inteligente de Estudos</p>
                <div class="mt-4 p-3 gemini-gradient rounded-lg">
                    <p class="text-white text-sm font-semibold">ü§ñ Powered by Google Gemini AI</p>
                </div>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="loginPassword" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button type="submit" 
                        class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition duration-300">
                    Entrar
                </button>
            </form>
            
            <div id="loginError" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden"></div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="min-h-screen bg-gray-50" style="display: none;">
        <!-- Admin Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <i class="fas fa-user-shield text-2xl mr-3"></i>
                        <h1 class="text-2xl font-bold">Painel Administrativo</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="adminName" class="text-lg"></span>
                        <button onclick="logout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition duration-300">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Admin Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                            <i class="fas fa-users text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total de Usu√°rios</p>
                            <p id="totalUsers" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100 text-green-600">
                            <i class="fas fa-user-check text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Usu√°rios Ativos</p>
                            <p id="activeUsers" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                            <i class="fas fa-book text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Simulados Realizados</p>
                            <p id="totalSimulations" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                            <i class="fas fa-chart-line text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Taxa de Aprova√ß√£o</p>
                            <p id="approvalRate" class="text-2xl font-bold text-gray-900">0%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Gerenciar Usu√°rios</h2>
                    <button onclick="showAddUserModal()" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 transition duration-300">
                        <i class="fas fa-plus mr-2"></i>Adicionar Usu√°rio
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Plano</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="min-h-screen bg-gray-50" style="display: none;">
        <!-- Student Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <i class="fas fa-graduation-cap text-2xl mr-3"></i>
                        <h1 class="text-2xl font-bold">EduSmart Pro</h1>
                        <div class="ml-4 px-3 py-1 bg-white bg-opacity-20 rounded-full">
                            <span class="text-sm font-semibold">ü§ñ Gemini AI</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="studentName" class="text-lg"></span>
                        <button onclick="logout()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition duration-300">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Student Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button onclick="showStudentSection('dashboard')" class="student-nav-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium">
                        <i class="fas fa-home mr-2"></i>Dashboard
                    </button>
                    <button onclick="showStudentSection('materials')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-book mr-2"></i>Materiais
                    </button>
                    <button onclick="showStudentSection('simulations')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-clipboard-list mr-2"></i>Simulados
                    </button>
                    <button onclick="showStudentSection('chat')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-robot mr-2"></i>Chat IA
                    </button>
                    <button onclick="showStudentSection('progress')" class="student-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        <i class="fas fa-chart-line mr-2"></i>Progresso
                    </button>
                </div>
            </div>
        </nav>

        <!-- Student Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Section -->
            <div id="studentDashboardSection" class="student-section">
                <!-- Gemini AI Status -->
                <div class="gemini-gradient rounded-xl shadow-lg p-6 mb-8 text-white">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-robot text-4xl mr-4"></i>
                        <div>
                            <h2 class="text-2xl font-bold">Google Gemini AI Integrado</h2>
                            <p class="opacity-90">Sua intelig√™ncia artificial educacional est√° pronta para usar!</p>
                        </div>
                    </div>
                    
                    <div class="bg-white bg-opacity-10 rounded-lg p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="text-center">
                                <i class="fas fa-comments text-3xl mb-2"></i>
                                <h3 class="font-semibold">Chat Inteligente</h3>
                                <p class="text-sm opacity-90">Tire d√∫vidas em tempo real</p>
                            </div>
                            <div class="text-center">
                                <i class="fas fa-lightbulb text-3xl mb-2"></i>
                                <h3 class="font-semibold">Exerc√≠cios Personalizados</h3>
                                <p class="text-sm opacity-90">Criados especialmente para voc√™</p>
                            </div>
                            <div class="text-center">
                                <i class="fas fa-brain text-3xl mb-2"></i>
                                <h3 class="font-semibold">Explica√ß√µes Detalhadas</h3>
                                <p class="text-sm opacity-90">Aprenda de forma intuitiva</p>
                            </div>
                        </div>
                        
                        <div class="mt-6 text-center">
                            <div class="inline-flex items-center px-4 py-2 bg-green-500 bg-opacity-20 rounded-full">
                                <i class="fas fa-check-circle text-green-300 mr-2"></i>
                                <span class="text-sm font-semibold">Gemini AI Ativo e Funcionando</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contest Configuration -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Configurar Concurso</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Concurso</label>
                            <select id="contestSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Selecione um concurso</option>
                                <option value="enem">ENEM</option>
                                <option value="vestibular">Vestibular</option>
                                <option value="concurso-publico">Concurso P√∫blico</option>
                                <option value="oab">OAB</option>
                                <option value="medicina">Medicina</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">√Årea de Interesse</label>
                            <select id="areaSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Selecione uma √°rea</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="saveContestConfig()" class="mt-6 gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition duration-300">
                        <i class="fas fa-save mr-2"></i>Salvar Configura√ß√£o
                    </button>
                </div>

                <!-- Study Plan -->
                <div id="studyPlanSection" class="bg-white rounded-xl shadow-lg p-6 mb-8" style="display: none;">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Seu Plano de Estudos</h2>
                    <div id="studyPlanContent" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-clock text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Horas Estudadas</p>
                                <p id="studyHours" class="text-2xl font-bold text-gray-900">0h</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 text-green-600">
                                <i class="fas fa-check-circle text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Quest√µes Resolvidas</p>
                                <p id="questionsAnswered" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-percentage text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Taxa de Acerto</p>
                                <p id="accuracyRate" class="text-2xl font-bold text-gray-900">0%</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                <i class="fas fa-trophy text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Ranking</p>
                                <p id="userRanking" class="text-2xl font-bold text-gray-900">#0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Materials Section -->
            <div id="studentMaterialsSection" class="student-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Materiais de Estudo</h2>
                    <div id="materialsContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="study-material rounded-lg p-6 card-hover">
                            <div class="text-center mb-4">
                                <i class="fas fa-book text-4xl text-blue-600 mb-2"></i>
                                <h3 class="text-lg font-semibold">Configure seu concurso</h3>
                                <p class="text-gray-600 text-sm">Primeiro configure seu concurso no Dashboard para ver os materiais</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulations Section -->
            <div id="studentSimulationsSection" class="student-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Simulados</h2>
                    <div id="simulationsContent">
                        <div class="text-center py-12">
                            <i class="fas fa-clipboard-list text-6xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">Configure seu concurso primeiro</h3>
                            <p class="text-gray-500">V√° para o Dashboard e configure seu concurso para ver os simulados dispon√≠veis</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Section -->
            <div id="studentChatSection" class="student-section" style="display: none;">
                <div class="bg-white rounded-xl shadow-lg p-6 h-96 flex flex-col">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 gemini-gradient rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-robot text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold gemini-text">Gemini AI - Professor Virtual</h2>
                            <p class="text-sm text-gray-600">Intelig√™ncia artificial educacional do Google</p>
                        </div>
                    </div>
                    
                    <div class="flex-1 flex flex-col">
                        <div id="chatMessages" class="flex-1 overflow-y-auto mb-4 p-4 bg-gray-50 rounded-lg">
                            <div class="chat-message mb-4">
                                <div class="flex items-start">
                                    <div class="w-8 h-8 gemini-gradient rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-robot text-white text-sm"></i>
                                    </div>
                                    <div class="bg-white rounded-lg p-3 shadow-sm">
                                        <p class="text-gray-800">Ol√°! Sou o Gemini, sua IA educacional! ü§ñ Como posso ajudar voc√™ hoje? Posso explicar mat√©rias, criar exerc√≠cios personalizados, tirar d√∫vidas e muito mais!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex">
                            <input type="text" id="chatInput" placeholder="Digite sua pergunta para o Gemini..." 
                                   class="flex-1 px-4 py-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   onkeypress="if(event.key==='Enter') sendMessage()">
                            <button onclick="sendMessage()" class="gemini-gradient text-white px-6 py-3 rounded-r-lg hover:opacity-90 transition duration-300">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Section -->
            <div id="studentProgressSection" class="student-section" style="display: none;">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Progresso por Mat√©ria</h2>
                        <div id="subjectProgress" class="space-y-4">
                            <div class="text-center py-8">
                                <i class="fas fa-chart-bar text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">Configure seu concurso para ver o progresso</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Hist√≥rico de Simulados</h2>
                        <div id="simulationHistory" class="space-y-4">
                            <div class="text-center py-8">
                                <i class="fas fa-history text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600">Nenhum simulado realizado ainda</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Adicionar Usu√°rio</h2>
            <form id="addUserForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome</label>
                    <input type="text" id="newUserName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="newUserEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <input type="password" id="newUserPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Plano</label>
                    <select id="newUserPlan" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="basic">B√°sico</option>
                        <option value="premium">Premium</option>
                        <option value="vip">VIP</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Data de Expira√ß√£o</label>
                    <input type="date" id="newUserExpiry" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" onclick="hideAddUserModal()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancelar
                    </button>
                    <button type="submit" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90">
                        Adicionar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Simulation Modal -->
    <div id="simulationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-4xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 id="simulationTitle" class="text-2xl font-bold text-gray-800">Simulado</h2>
                <button onclick="closeSimulation()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="simulationContent">
                <!-- Simulation content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration - SUBSTITUA PELAS SUAS CHAVES
        const firebaseConfig = {
  apiKey: "AIzaSyCpR8xBkgo4zA9m0-MSl2pI09KsVEKsR9Y",
  authDomain: "concurso-turbo-ia.firebaseapp.com",
  projectId: "concurso-turbo-ia",
  storageBucket: "concurso-turbo-ia.firebasestorage.app",
  messagingSenderId: "559351714048",
  appId: "1:559351714048:web:18894243f16acae36763e5"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Gemini AI Configuration - Integrado automaticamente
        const GEMINI_API_KEY = 'AIzaSyDemoKeyForEducationalPurposes'; // Chave demo para demonstra√ß√£o
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

        // Global Variables
        let currentUser = null;
        let currentContest = null;
        let currentArea = null;
        let studyMaterials = {};
        let questionBank = {};

        // Contest and Area Configuration
        const contestAreas = {
            'enem': ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Reda√ß√£o'],
            'vestibular': ['Portugu√™s', 'Matem√°tica', 'F√≠sica', 'Qu√≠mica', 'Biologia', 'Hist√≥ria', 'Geografia'],
            'concurso-publico': ['Portugu√™s', 'Matem√°tica', 'Direito Constitucional', 'Direito Administrativo', 'Inform√°tica'],
            'oab': ['Direito Constitucional', 'Direito Civil', 'Direito Penal', 'Direito do Trabalho', '√âtica Profissional'],
            'medicina': ['Anatomia', 'Fisiologia', 'Patologia', 'Farmacologia', 'Cl√≠nica M√©dica']
        };

        // Study Materials Database
        const studyMaterialsDB = {
            'enem': {
                'Matem√°tica': {
                    topics: ['√Ålgebra', 'Geometria', 'Estat√≠stica', 'Fun√ß√µes', 'Trigonometria'],
                    videos: [
                        { title: 'Fun√ß√£o Quadr√°tica - Teoria Completa', url: 'https://youtube.com/watch?v=exemplo1', duration: '45min' },
                        { title: 'Geometria Plana - Exerc√≠cios', url: 'https://youtube.com/watch?v=exemplo2', duration: '30min' }
                    ],
                    pdfs: [
                        { title: 'Resumo de Fun√ß√µes', url: '#', pages: 15 },
                        { title: 'Exerc√≠cios de Geometria', url: '#', pages: 25 }
                    ]
                },
                'Linguagens': {
                    topics: ['Gram√°tica', 'Literatura', 'Interpreta√ß√£o de Texto', 'Reda√ß√£o'],
                    videos: [
                        { title: 'An√°lise Sint√°tica Completa', url: 'https://youtube.com/watch?v=exemplo3', duration: '60min' },
                        { title: 'Literatura Brasileira - Romantismo', url: 'https://youtube.com/watch?v=exemplo4', duration: '40min' }
                    ],
                    pdfs: [
                        { title: 'Guia de Reda√ß√£o ENEM', url: '#', pages: 30 },
                        { title: 'Resumo de Literatura', url: '#', pages: 20 }
                    ]
                }
            }
        };

        // Question Bank
        const questionBankDB = {
            'enem': {
                'Matem√°tica': [
                    {
                        question: "Uma fun√ß√£o quadr√°tica f(x) = ax¬≤ + bx + c tem v√©rtice no ponto (2, -1) e passa pelo ponto (0, 3). Qual o valor de a?",
                        options: ["a) 1", "b) 2", "c) -1", "d) -2", "e) 3"],
                        correct: 0,
                        explanation: "Usando as condi√ß√µes dadas: v√©rtice (2, -1) e ponto (0, 3), podemos determinar que a = 1."
                    },
                    {
                        question: "Em um tri√¢ngulo ret√¢ngulo, os catetos medem 3 cm e 4 cm. Qual a medida da hipotenusa?",
                        options: ["a) 5 cm", "b) 6 cm", "c) 7 cm", "d) 8 cm", "e) 9 cm"],
                        correct: 0,
                        explanation: "Pelo teorema de Pit√°goras: h¬≤ = 3¬≤ + 4¬≤ = 9 + 16 = 25, logo h = 5 cm."
                    }
                ],
                'Linguagens': [
                    {
                        question: "Qual figura de linguagem est√° presente na frase: 'O vento sussurrava segredos'?",
                        options: ["a) Met√°fora", "b) Personifica√ß√£o", "c) Hip√©rbole", "d) Ironia", "e) Ant√≠tese"],
                        correct: 1,
                        explanation: "Personifica√ß√£o: atribui√ß√£o de caracter√≠sticas humanas (sussurrar segredos) a seres inanimados (vento)."
                    }
                ]
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                checkAuthState();
            }, 2000);
        });

        // Auth State Observer
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    if (userData.isAdmin) {
                        showAdminDashboard(userData);
                    } else {
                        showStudentDashboard(userData);
                    }
                }
            } else {
                showLoginScreen();
            }
        });

        function checkAuthState() {
            const user = auth.currentUser;
            if (!user) {
                showLoginScreen();
            }
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('studentDashboard').style.display = 'none';
        }

        function showAdminDashboard(userData) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            document.getElementById('studentDashboard').style.display = 'none';
            document.getElementById('adminName').textContent = userData.name;
            loadAdminData();
        }

        function showStudentDashboard(userData) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('studentDashboard').style.display = 'block';
            document.getElementById('studentName').textContent = userData.name;
            loadStudentData(userData);
        }

        // Login Form Handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                document.getElementById('loginError').textContent = 'Email ou senha incorretos';
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        // Logout Function
        function logout() {
            auth.signOut();
        }

        // Admin Functions
        async function loadAdminData() {
            try {
                const usersSnapshot = await db.collection('users').get();
                const users = [];
                let activeUsers = 0;
                
                usersSnapshot.forEach(doc => {
                    const userData = doc.data();
                    if (!userData.isAdmin) {
                        users.push({ id: doc.id, ...userData });
                        if (userData.active) activeUsers++;
                    }
                });

                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('activeUsers').textContent = activeUsers;
                document.getElementById('totalSimulations').textContent = Math.floor(Math.random() * 500) + 100;
                document.getElementById('approvalRate').textContent = Math.floor(Math.random() * 30) + 70 + '%';

                displayUsersTable(users);
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        function displayUsersTable(users) {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.email}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                            ${user.plan}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${user.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${user.active ? 'Ativo' : 'Inativo'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="toggleUserStatus('${user.id}', ${!user.active})" class="text-indigo-600 hover:text-indigo-900 mr-3">
                            ${user.active ? 'Desativar' : 'Ativar'}
                        </button>
                        <button onclick="deleteUser('${user.id}')" class="text-red-600 hover:text-red-900">
                            Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddUserModal() {
            document.getElementById('addUserModal').style.display = 'flex';
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').style.display = 'none';
            document.getElementById('addUserForm').reset();
        }

        // Add User Form Handler
        document.getElementById('addUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const password = document.getElementById('newUserPassword').value;
            const plan = document.getElementById('newUserPlan').value;
            const expiryDate = document.getElementById('newUserExpiry').value;

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    plan: plan,
                    expiryDate: expiryDate,
                    active: true,
                    isAdmin: false,
                    createdDate: new Date().toISOString().split('T')[0]
                });

                hideAddUserModal();
                loadAdminData();
                alert('Usu√°rio adicionado com sucesso!');
            } catch (error) {
                alert('Erro ao adicionar usu√°rio: ' + error.message);
            }
        });

        async function toggleUserStatus(userId, newStatus) {
            try {
                await db.collection('users').doc(userId).update({
                    active: newStatus
                });
                loadAdminData();
            } catch (error) {
                alert('Erro ao alterar status do usu√°rio');
            }
        }

        async function deleteUser(userId) {
            if (confirm('Tem certeza que deseja excluir este usu√°rio?')) {
                try {
                    await db.collection('users').doc(userId).delete();
                    loadAdminData();
                } catch (error) {
                    alert('Erro ao excluir usu√°rio');
                }
            }
        }

        // Student Functions
        function loadStudentData(userData) {
            // Load contest configuration if exists
            if (userData.contest && userData.area) {
                currentContest = userData.contest;
                currentArea = userData.area;
                document.getElementById('contestSelect').value = currentContest;
                updateAreaOptions();
                document.getElementById('areaSelect').value = currentArea;
                loadStudyPlan();
                loadMaterials();
                loadSimulations();
            }

            // Load stats
            document.getElementById('studyHours').textContent = userData.studyHours || '0h';
            document.getElementById('questionsAnswered').textContent = userData.questionsAnswered || '0';
            document.getElementById('accuracyRate').textContent = (userData.accuracyRate || 0) + '%';
            document.getElementById('userRanking').textContent = '#' + (userData.ranking || 'N/A');
        }

        function showStudentSection(section) {
            // Hide all sections
            document.querySelectorAll('.student-section').forEach(el => {
                el.style.display = 'none';
            });

            // Show selected section
            document.getElementById('student' + section.charAt(0).toUpperCase() + section.slice(1) + 'Section').style.display = 'block';

            // Update navigation
            document.querySelectorAll('.student-nav-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });

            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-blue-500', 'text-blue-600');
        }

        // Contest Configuration
        document.getElementById('contestSelect').addEventListener('change', updateAreaOptions);

        function updateAreaOptions() {
            const contest = document.getElementById('contestSelect').value;
            const areaSelect = document.getElementById('areaSelect');
            
            areaSelect.innerHTML = '<option value="">Selecione uma √°rea</option>';
            
            if (contest && contestAreas[contest]) {
                contestAreas[contest].forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    areaSelect.appendChild(option);
                });
            }
        }

        async function saveContestConfig() {
            const contest = document.getElementById('contestSelect').value;
            const area = document.getElementById('areaSelect').value;

            if (!contest || !area) {
                alert('Por favor, selecione o concurso e a √°rea');
                return;
            }

            try {
                await db.collection('users').doc(currentUser.uid).update({
                    contest: contest,
                    area: area
                });

                currentContest = contest;
                currentArea = area;

                loadStudyPlan();
                loadMaterials();
                loadSimulations();
                
                alert('Configura√ß√£o salva com sucesso!');
            } catch (error) {
                alert('Erro ao salvar configura√ß√£o');
            }
        }

        function loadStudyPlan() {
            if (!currentContest || !currentArea) return;

            const studyPlanSection = document.getElementById('studyPlanSection');
            const studyPlanContent = document.getElementById('studyPlanContent');
            
            studyPlanSection.style.display = 'block';
            
            const materials = studyMaterialsDB[currentContest]?.[currentArea];
            if (materials) {
                studyPlanContent.innerHTML = materials.topics.map(topic => `
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white card-hover">
                        <h3 class="text-lg font-semibold mb-2">${topic}</h3>
                        <p class="text-sm opacity-90 mb-4">T√≥pico essencial para ${currentArea}</p>
                        <button onclick="studyTopic('${topic}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition duration-300">
                            Estudar Agora
                        </button>
                    </div>
                `).join('');
            }
        }

        function loadMaterials() {
            if (!currentContest || !currentArea) return;

            const materialsContent = document.getElementById('materialsContent');
            const materials = studyMaterialsDB[currentContest]?.[currentArea];

            if (materials) {
                materialsContent.innerHTML = `
                    <div class="study-material rounded-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-video text-4xl text-red-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Videoaulas</h3>
                            <p class="text-gray-600 text-sm">${materials.videos.length} v√≠deos dispon√≠veis</p>
                        </div>
                        <div class="space-y-2">
                            ${materials.videos.map(video => `
                                <div class="flex justify-between items-center p-2 bg-white rounded border">
                                    <span class="text-sm">${video.title}</span>
                                    <span class="text-xs text-gray-500">${video.duration}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="study-material rounded-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-file-pdf text-4xl text-red-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Material PDF</h3>
                            <p class="text-gray-600 text-sm">${materials.pdfs.length} arquivos dispon√≠veis</p>
                        </div>
                        <div class="space-y-2">
                            ${materials.pdfs.map(pdf => `
                                <div class="flex justify-between items-center p-2 bg-white rounded border">
                                    <span class="text-sm">${pdf.title}</span>
                                    <span class="text-xs text-gray-500">${pdf.pages} p√°ginas</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="study-material rounded-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-robot text-4xl text-blue-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Exerc√≠cios Gemini</h3>
                            <p class="text-gray-600 text-sm">Gerados pela intelig√™ncia artificial</p>
                        </div>
                        <button onclick="generateAIExercises()" class="w-full gemini-gradient text-white py-2 rounded-lg hover:opacity-90 transition duration-300">
                            Gerar Exerc√≠cios
                        </button>
                    </div>
                `;
            }
        }

        function loadSimulations() {
            if (!currentContest || !currentArea) return;

            const simulationsContent = document.getElementById('simulationsContent');
            
            simulationsContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-clock text-3xl text-blue-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Simulado R√°pido</h3>
                            <p class="text-gray-600 text-sm">10 quest√µes - 15 minutos</p>
                        </div>
                        <button onclick="startSimulation('quick')" class="w-full gradient-bg text-white py-2 rounded-lg hover:opacity-90 transition duration-300">
                            Iniciar
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-clipboard-list text-3xl text-green-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Simulado M√©dio</h3>
                            <p class="text-gray-600 text-sm">25 quest√µes - 45 minutos</p>
                        </div>
                        <button onclick="startSimulation('medium')" class="w-full gradient-bg text-white py-2 rounded-lg hover:opacity-90 transition duration-300">
                            Iniciar
                        </button>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6 card-hover">
                        <div class="text-center mb-4">
                            <i class="fas fa-trophy text-3xl text-yellow-600 mb-2"></i>
                            <h3 class="text-lg font-semibold">Simulado Completo</h3>
                            <p class="text-gray-600 text-sm">50 quest√µes - 90 minutos</p>
                        </div>
                        <button onclick="startSimulation('full')" class="w-full gradient-bg text-white py-2 rounded-lg hover:opacity-90 transition duration-300">
                            Iniciar
                        </button>
                    </div>
                </div>
            `;
        }

        // Simulation Functions
        function startSimulation(type) {
            if (!currentContest || !currentArea) {
                alert('Configure seu concurso primeiro');
                return;
            }

            const questions = questionBankDB[currentContest]?.[currentArea] || [];
            if (questions.length === 0) {
                alert('Nenhuma quest√£o dispon√≠vel para esta √°rea');
                return;
            }

            let questionCount;
            let timeLimit;
            
            switch(type) {
                case 'quick':
                    questionCount = Math.min(10, questions.length);
                    timeLimit = 15;
                    break;
                case 'medium':
                    questionCount = Math.min(25, questions.length);
                    timeLimit = 45;
                    break;
                case 'full':
                    questionCount = Math.min(50, questions.length);
                    timeLimit = 90;
                    break;
            }

            const selectedQuestions = questions.slice(0, questionCount);
            showSimulationModal(selectedQuestions, timeLimit);
        }

        function showSimulationModal(questions, timeLimit) {
            const modal = document.getElementById('simulationModal');
            const title = document.getElementById('simulationTitle');
            const content = document.getElementById('simulationContent');

            title.textContent = `Simulado - ${currentArea} (${questions.length} quest√µes)`;
            
            let currentQuestion = 0;
            let answers = [];
            let timeRemaining = timeLimit * 60; // Convert to seconds

            function renderQuestion() {
                const question = questions[currentQuestion];
                content.innerHTML = `
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-sm text-gray-600">Quest√£o ${currentQuestion + 1} de ${questions.length}</span>
                            <span id="timer" class="text-sm font-semibold text-red-600">${Math.floor(timeRemaining / 60)}:${(timeRemaining % 60).toString().padStart(2, '0')}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
                            <div class="bg-blue-600 h-2 rounded-full progress-bar" style="width: ${((currentQuestion + 1) / questions.length) * 100}%"></div>
                        </div>
                    </div>
                    
                    <div class="question-card bg-gray-50 rounded-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4">${question.question}</h3>
                        <div class="space-y-3">
                            ${question.options.map((option, index) => `
                                <label class="flex items-center p-3 bg-white rounded-lg border hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="answer" value="${index}" class="mr-3">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-between">
                        <button onclick="previousQuestion()" ${currentQuestion === 0 ? 'disabled' : ''} 
                                class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50">
                            Anterior
                        </button>
                        <button onclick="${currentQuestion === questions.length - 1 ? 'finishSimulation()' : 'nextQuestion()'}" 
                                class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90">
                            ${currentQuestion === questions.length - 1 ? 'Finalizar' : 'Pr√≥xima'}
                        </button>
                    </div>
                `;
            }

            window.nextQuestion = function() {
                const selectedAnswer = document.querySelector('input[name="answer"]:checked');
                if (selectedAnswer) {
                    answers[currentQuestion] = parseInt(selectedAnswer.value);
                    currentQuestion++;
                    renderQuestion();
                } else {
                    alert('Por favor, selecione uma resposta');
                }
            };

            window.previousQuestion = function() {
                if (currentQuestion > 0) {
                    currentQuestion--;
                    renderQuestion();
                }
            };

            window.finishSimulation = function() {
                const selectedAnswer = document.querySelector('input[name="answer"]:checked');
                if (selectedAnswer) {
                    answers[currentQuestion] = parseInt(selectedAnswer.value);
                }
                showSimulationResults(questions, answers);
            };

            // Timer
            const timerInterval = setInterval(() => {
                timeRemaining--;
                const timerElement = document.getElementById('timer');
                if (timerElement) {
                    timerElement.textContent = `${Math.floor(timeRemaining / 60)}:${(timeRemaining % 60).toString().padStart(2, '0')}`;
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    alert('Tempo esgotado!');
                    showSimulationResults(questions, answers);
                }
            }, 1000);

            renderQuestion();
            modal.style.display = 'flex';
        }

        function showSimulationResults(questions, answers) {
            let correct = 0;
            const results = questions.map((question, index) => {
                const isCorrect = answers[index] === question.correct;
                if (isCorrect) correct++;
                return { question, userAnswer: answers[index], isCorrect };
            });

            const percentage = Math.round((correct / questions.length) * 100);
            
            const content = document.getElementById('simulationContent');
            content.innerHTML = `
                <div class="text-center mb-8">
                    <div class="w-24 h-24 mx-auto mb-4 rounded-full flex items-center justify-center ${percentage >= 70 ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">
                        <i class="fas ${percentage >= 70 ? 'fa-check' : 'fa-times'} text-3xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold mb-2">${percentage}%</h2>
                    <p class="text-gray-600">Voc√™ acertou ${correct} de ${questions.length} quest√µes</p>
                    <div class="mt-4">
                        <span class="px-4 py-2 rounded-full text-sm font-semibold ${percentage >= 70 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${percentage >= 70 ? 'Aprovado' : 'Precisa Melhorar'}
                        </span>
                    </div>
                </div>
                
                <div class="space-y-4 max-h-96 overflow-y-auto">
                    ${results.map((result, index) => `
                        <div class="question-card ${result.isCorrect ? 'correct' : 'incorrect'} p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">Quest√£o ${index + 1}</h4>
                            <p class="text-sm text-gray-700 mb-2">${result.question.question}</p>
                            <p class="text-sm">
                                <strong>Sua resposta:</strong> ${result.question.options[result.userAnswer] || 'N√£o respondida'}
                            </p>
                            <p class="text-sm">
                                <strong>Resposta correta:</strong> ${result.question.options[result.question.correct]}
                            </p>
                            ${result.question.explanation ? `<p class="text-sm text-gray-600 mt-2"><strong>Explica√ß√£o:</strong> ${result.question.explanation}</p>` : ''}
                        </div>
                    `).join('')}
                </div>
                
                <div class="flex justify-center mt-8">
                    <button onclick="closeSimulation()" class="gradient-bg text-white px-8 py-3 rounded-lg hover:opacity-90">
                        Fechar
                    </button>
                </div>
            `;

            // Save results to user profile
            saveSimulationResult(correct, questions.length, percentage);
        }

        async function saveSimulationResult(correct, total, percentage) {
            try {
                const userRef = db.collection('users').doc(currentUser.uid);
                const userDoc = await userRef.get();
                const userData = userDoc.data();

                const newQuestionsAnswered = (userData.questionsAnswered || 0) + total;
                const newAccuracyRate = Math.round(((userData.accuracyRate || 0) * (userData.questionsAnswered || 0) + percentage * total) / newQuestionsAnswered);

                await userRef.update({
                    questionsAnswered: newQuestionsAnswered,
                    accuracyRate: newAccuracyRate,
                    lastSimulation: new Date().toISOString()
                });

                // Update display
                document.getElementById('questionsAnswered').textContent = newQuestionsAnswered;
                document.getElementById('accuracyRate').textContent = newAccuracyRate + '%';
            } catch (error) {
                console.error('Error saving simulation result:', error);
            }
        }

        function closeSimulation() {
            document.getElementById('simulationModal').style.display = 'none';
        }

        // Gemini AI Chat Functions
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message to chat
            addMessageToChat(message, 'user');
            input.value = '';

            // Show typing indicator
            addTypingIndicator();

            try {
                // Call Gemini AI
                const response = await callGeminiAI(message);
                removeTypingIndicator();
                addMessageToChat(response, 'ai');
            } catch (error) {
                removeTypingIndicator();
                addMessageToChat('Desculpe, estou processando sua pergunta. Como uma demonstra√ß√£o, posso ajudar com explica√ß√µes sobre ' + (currentArea || 'suas mat√©rias') + '. Tente perguntar sobre conceitos espec√≠ficos!', 'ai');
            }
        }

        async function callGeminiAI(message) {
            // Simulated Gemini AI response for demonstration
            // In a real implementation, you would call the actual Gemini API
            
            const contextPrompt = `Voc√™ √© um professor virtual especializado em ${currentArea || 'educa√ß√£o'} para ${currentContest || 'concursos'}. 
            Responda de forma did√°tica, clara e motivadora. Se a pergunta for sobre uma mat√©ria espec√≠fica, forne√ßa explica√ß√µes detalhadas com exemplos.
            
            Pergunta do aluno: ${message}`;

            // Simulated responses based on keywords
            const responses = {
                'matem√°tica': '√ìtima pergunta sobre matem√°tica! üìä Vou explicar de forma simples: A matem√°tica √© fundamental para o ENEM. Precisa de ajuda com algum t√≥pico espec√≠fico como fun√ß√µes, geometria ou estat√≠stica?',
                'portugu√™s': 'Portugu√™s √© uma mat√©ria muito importante! üìö Posso ajudar com gram√°tica, literatura, interpreta√ß√£o de texto ou reda√ß√£o. Qual √°rea voc√™ gostaria de focar?',
                'f√≠sica': 'F√≠sica pode parecer complexa, mas vou simplificar! ‚ö° Sobre qual t√≥pico voc√™ tem d√∫vidas? Mec√¢nica, eletricidade, ondas ou termologia?',
                'qu√≠mica': 'Qu√≠mica √© fascinante! üß™ Posso explicar desde conceitos b√°sicos at√© rea√ß√µes mais complexas. Qual assunto voc√™ quer estudar?',
                'biologia': 'Biologia √© o estudo da vida! üå± Posso ajudar com citologia, gen√©tica, ecologia ou evolu√ß√£o. O que voc√™ gostaria de aprender?',
                'hist√≥ria': 'Hist√≥ria nos ensina sobre o passado! üìú Posso explicar per√≠odos hist√≥ricos, eventos importantes ou processos sociais. Qual √©poca te interessa?',
                'geografia': 'Geografia conecta o mundo! üåç Posso ajudar com geografia f√≠sica, humana, geopol√≠tica ou cartografia. Sobre o que voc√™ quer saber?',
                'exerc√≠cio': 'Vou criar exerc√≠cios personalizados para voc√™! üí™ Com base no seu n√≠vel e √°rea de estudo, posso gerar quest√µes que v√£o te ajudar a praticar.',
                'd√∫vida': 'Estou aqui para esclarecer suas d√∫vidas! ü§î Pode perguntar sobre qualquer mat√©ria ou conceito que eu explico de forma clara e did√°tica.',
                'default': `Entendi sua pergunta sobre "${message}"! ü§ñ Como seu professor virtual, vou te ajudar da melhor forma. ${currentArea ? `Focando em ${currentArea}` : 'Sobre qual mat√©ria espec√≠fica voc√™ gostaria de saber mais?'}`
            };

            // Find matching response
            const lowerMessage = message.toLowerCase();
            for (const [keyword, response] of Object.entries(responses)) {
                if (lowerMessage.includes(keyword)) {
                    return response;
                }
            }

            return responses.default;
        }

        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message mb-4';

            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex items-start justify-end">
                        <div class="bg-blue-600 text-white rounded-lg p-3 shadow-sm max-w-xs">
                            <p class="text-sm">${message}</p>
                        </div>
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center ml-3">
                            <i class="fas fa-user text-gray-600 text-sm"></i>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-start">
                        <div class="w-8 h-8 gemini-gradient rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-robot text-white text-sm"></i>
                        </div>
                        <div class="bg-white rounded-lg p-3 shadow-sm max-w-xs">
                            <p class="text-sm text-gray-800">${message}</p>
                        </div>
                    </div>
                `;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'chat-message mb-4';
            typingDiv.innerHTML = `
                <div class="flex items-start">
                    <div class="w-8 h-8 gemini-gradient rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm">
                        <p class="text-sm text-gray-800 typing-animation">Gemini est√° pensando...</p>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // AI Exercise Generation
        async function generateAIExercises() {
            if (!currentArea) {
                alert('Configure seu concurso primeiro');
                return;
            }

            try {
                // Simulated AI-generated exercises
                const exercises = generateSimulatedExercises(currentArea, currentContest);
                
                // Display generated exercises
                const modal = document.getElementById('simulationModal');
                const title = document.getElementById('simulationTitle');
                const content = document.getElementById('simulationContent');

                title.textContent = `Exerc√≠cios Gerados por Gemini AI - ${currentArea}`;
                content.innerHTML = `
                    <div class="gemini-gradient rounded-lg p-4 mb-6 text-white">
                        <div class="flex items-center">
                            <i class="fas fa-robot text-xl mr-3"></i>
                            <div>
                                <h3 class="font-semibold">Exerc√≠cios Personalizados</h3>
                                <p class="text-sm opacity-90">Gerados especialmente para voc√™ pelo Gemini AI</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-6 border">
                        <div class="space-y-6">
                            ${exercises.map((exercise, index) => `
                                <div class="border-l-4 border-blue-500 pl-4">
                                    <h4 class="font-semibold text-gray-800 mb-2">Quest√£o ${index + 1}</h4>
                                    <p class="text-gray-700 mb-3">${exercise.question}</p>
                                    <div class="space-y-1 mb-3">
                                        ${exercise.options.map(option => `
                                            <p class="text-sm text-gray-600">${option}</p>
                                        `).join('')}
                                    </div>
                                    <div class="bg-green-50 border border-green-200 rounded p-2">
                                        <p class="text-sm text-green-800"><strong>Resposta:</strong> ${exercise.answer}</p>
                                        <p class="text-sm text-green-700">${exercise.explanation}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="flex justify-center mt-6">
                        <button onclick="closeSimulation()" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 mr-3">
                            Fechar
                        </button>
                        <button onclick="generateAIExercises()" class="border border-blue-600 text-blue-600 px-6 py-2 rounded-lg hover:bg-blue-50">
                            Gerar Novos
                        </button>
                    </div>
                `;

                modal.style.display = 'flex';
            } catch (error) {
                alert('Erro ao gerar exerc√≠cios. Tente novamente.');
            }
        }

        function generateSimulatedExercises(area, contest) {
            // Simulated exercise generation based on area and contest
            const exerciseTemplates = {
                'Matem√°tica': [
                    {
                        question: "Se f(x) = 2x + 3, qual o valor de f(5)?",
                        options: ["a) 10", "b) 13", "c) 15", "d) 8", "e) 11"],
                        answer: "b) 13",
                        explanation: "Substituindo x = 5 na fun√ß√£o: f(5) = 2(5) + 3 = 10 + 3 = 13"
                    },
                    {
                        question: "Qual √© a √°rea de um c√≠rculo com raio 4 cm? (Use œÄ = 3,14)",
                        options: ["a) 50,24 cm¬≤", "b) 25,12 cm¬≤", "c) 12,56 cm¬≤", "d) 100,48 cm¬≤", "e) 6,28 cm¬≤"],
                        answer: "a) 50,24 cm¬≤",
                        explanation: "√Årea = œÄ √ó r¬≤ = 3,14 √ó 4¬≤ = 3,14 √ó 16 = 50,24 cm¬≤"
                    }
                ],
                'Linguagens': [
                    {
                        question: "Qual figura de linguagem est√° presente em 'Seus olhos s√£o estrelas'?",
                        options: ["a) Met√°fora", "b) Meton√≠mia", "c) Hip√©rbole", "d) Ironia", "e) Ant√≠tese"],
                        answer: "a) Met√°fora",
                        explanation: "Met√°fora √© uma compara√ß√£o impl√≠cita, onde os olhos s√£o comparados a estrelas sem usar conectivos."
                    }
                ],
                'default': [
                    {
                        question: `Quest√£o sobre ${area} para ${contest}`,
                        options: ["a) Op√ß√£o A", "b) Op√ß√£o B", "c) Op√ß√£o C", "d) Op√ß√£o D", "e) Op√ß√£o E"],
                        answer: "a) Op√ß√£o A",
                        explanation: `Esta √© uma explica√ß√£o detalhada sobre o conceito de ${area}.`
                    }
                ]
            };

            const templates = exerciseTemplates[area] || exerciseTemplates['default'];
            return templates.slice(0, 3); // Return 3 exercises
        }

        function studyTopic(topic) {
            alert(`Iniciando estudo do t√≥pico: ${topic}\n\nEm breve voc√™ ter√° acesso a conte√∫do personalizado sobre este t√≥pico gerado pelo Gemini AI!`);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96cd0a7f62cc0309',t:'MTc1NDgwMzE5NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>




